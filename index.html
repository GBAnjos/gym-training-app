<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym Training Tracker</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a1a2e">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        :root {
            --bg-primary: #0f0f1e;
            --bg-secondary: #1a1a2e;
            --bg-tertiary: #252538;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --accent: #00d9ff;
            --accent-hover: #00b8d4;
            --border: #2a2a3e;
            --success: #4caf50;
            --warning: #ff9800;
            --danger: #f44336;
            --shadow: rgba(0, 0, 0, 0.3);
        }

        [data-theme="light"] {
            --bg-primary: #ffffff;
            --bg-secondary: #f5f5f5;
            --bg-tertiary: #e8e8e8;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --accent: #0088cc;
            --accent-hover: #006699;
            --border: #d0d0d0;
            --success: #2e7d32;
            --warning: #f57c00;
            --danger: #c62828;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 20px;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        h1 {
            color: var(--accent);
            font-size: 1.8em;
            flex: 1;
            min-width: 200px;
        }

        .theme-switch-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .theme-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: 0.3s;
            border-radius: 30px;
        }

        .theme-slider:before {
            position: absolute;
            content: "üåô";
            height: 24px;
            width: 24px;
            left: 3px;
            bottom: 3px;
            background-color: var(--bg-primary);
            transition: 0.3s;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        input:checked + .theme-slider {
            background-color: var(--accent);
        }

        input:checked + .theme-slider:before {
            content: "‚òÄÔ∏è";
            transform: translateX(30px);
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .card {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px var(--shadow);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            flex: 1;
            min-width: 120px;
        }

        button:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        button.secondary:hover {
            background: var(--border);
        }

        button.danger {
            background: var(--danger);
        }

        button.danger:hover {
            background: #d32f2f;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 217, 255, 0.1);
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .workout-entry {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid var(--accent);
        }

        .workout-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .workout-date {
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        .exercise-list {
            margin-top: 10px;
        }

        .exercise-item {
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
        }

        .exercise-name {
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 5px;
        }

        .set-info {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-left: 10px;
        }

        .note-section {
            background: var(--bg-secondary);
            padding: 10px;
            border-radius: 6px;
            margin-top: 8px;
            border-left: 3px solid var(--warning);
        }

        .note-text {
            color: var(--text-secondary);
            font-size: 0.9em;
            font-style: italic;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .stat-card {
            background: var(--bg-tertiary);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: var(--accent);
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9em;
            margin-top: 5px;
        }

        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
        }

        .tab-button {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            color: var(--text-primary);
            white-space: nowrap;
            transition: all 0.3s ease;
        }

        .tab-button.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-btn:hover {
            background: #d32f2f;
        }

        @media (max-width: 600px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            button {
                width: 100%;
            }

            header {
                text-align: center;
            }

            h1 {
                font-size: 1.5em;
            }
        }

        .hidden {
            display: none;
        }

        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .status-success {
            background: var(--success);
            color: white;
        }

        .status-error {
            background: var(--danger);
            color: white;
        }

        .status-info {
            background: var(--accent);
            color: white;
        }

        #installPrompt {
            background: linear-gradient(135deg, var(--accent), #0088cc);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px var(--shadow);
        }

        #installPrompt button {
            background: white;
            color: var(--accent);
            padding: 8px 16px;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üí™ Gym Training Tracker</h1>
            <div class="header-actions">
                <div class="theme-switch-wrapper">
                    <label class="theme-switch">
                        <input type="checkbox" id="themeToggle">
                        <span class="theme-slider"></span>
                    </label>
                </div>
            </div>
        </header>

        <div id="installPrompt" class="hidden">
            <span>üì± Instalar app no seu dispositivo?</span>
            <button onclick="installApp()">Instalar</button>
        </div>

        <div class="tab-buttons">
            <div class="tab-button active" onclick="switchTab('log')">üìù Registrar Treino</div>
            <div class="tab-button" onclick="switchTab('history')">üìä Hist√≥rico</div>
            <div class="tab-button" onclick="switchTab('stats')">üìà Estat√≠sticas</div>
            <div class="tab-button" onclick="switchTab('backup')">‚òÅÔ∏è Backup</div>
        </div>

        <div id="logTab" class="tab-content active">
            <div class="card">
                <h2>Registrar Novo Treino</h2>
                <input type="date" id="workoutDate" />
                
                <h3 style="margin-top: 20px;">Exerc√≠cios</h3>
                <div id="exerciseInputs"></div>
                <button onclick="addExerciseInput()" class="secondary">+ Adicionar Exerc√≠cio</button>
                <button onclick="saveWorkout()" style="margin-top: 15px;">üíæ Salvar Treino</button>
            </div>
        </div>

        <div id="historyTab" class="tab-content">
            <div class="card">
                <h2>Hist√≥rico de Treinos</h2>
                <div id="workoutHistory"></div>
            </div>
        </div>

        <div id="statsTab" class="tab-content">
            <div class="card">
                <h2>Estat√≠sticas</h2>
                <div class="stats-grid" id="statsContainer"></div>
            </div>
        </div>

        <div id="backupTab" class="tab-content">
            <div class="card">
                <h2>Backup e Restaura√ß√£o</h2>
                <div id="backupStatus"></div>
                
                <h3>Google Drive (Auto-Backup)</h3>
                <div class="button-group">
                    <button onclick="authenticateGoogleDrive()">üîê Conectar Google Drive</button>
                    <button onclick="backupToGoogleDrive()" class="secondary">‚òÅÔ∏è Backup Manual</button>
                    <button onclick="restoreFromGoogleDrive()" class="secondary">üì• Restaurar do Drive</button>
                </div>

                <h3 style="margin-top: 25px;">Backup Local</h3>
                <div class="button-group">
                    <button onclick="exportToJSON()" class="secondary">üíæ Exportar JSON</button>
                    <button onclick="exportToCSV()" class="secondary">üìÑ Exportar CSV</button>
                </div>

                <h3 style="margin-top: 25px;">Importar Dados</h3>
                <input type="file" id="importFile" accept=".json,.csv" style="margin-bottom: 10px;" />
                <button onclick="importData()" class="secondary">üìÇ Importar Arquivo</button>

                <h3 style="margin-top: 25px;">‚ö†Ô∏è Zona de Perigo</h3>
                <button onclick="clearAllData()" class="danger">üóëÔ∏è Limpar Todos os Dados</button>
            </div>
        </div>
    </div>

    <script>
        // Theme Management
        const themeToggle = document.getElementById('themeToggle');
        const currentTheme = localStorage.getItem('theme') || 'dark';

        // Set initial theme
        if (currentTheme === 'light') {
            document.documentElement.setAttribute('data-theme', 'light');
            themeToggle.checked = true;
        }

        themeToggle.addEventListener('change', function() {
            if (this.checked) {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            } else {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            }
        });

        // PWA Installation
        let deferredPrompt;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').classList.remove('hidden');
        });

        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                deferredPrompt = null;
                document.getElementById('installPrompt').classList.add('hidden');
            }
        }

        // Data Storage
        let workouts = JSON.parse(localStorage.getItem('workouts')) || [];
        let googleDriveToken = localStorage.getItem('googleDriveToken');

        // Initialize
        document.getElementById('workoutDate').valueAsDate = new Date();
        addExerciseInput();
        loadWorkoutHistory();
        updateStats();

        if (googleDriveToken) {
            showStatus('backupStatus', 'Conectado ao Google Drive', 'success');
        }

        // Tab Management
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        // Exercise Input Management
        function addExerciseInput() {
            const container = document.getElementById('exerciseInputs');
            const exerciseDiv = document.createElement('div');
            exerciseDiv.className = 'workout-entry';
            exerciseDiv.innerHTML = `
                <input type="text" placeholder="Nome do exerc√≠cio" class="exercise-name-input" />
                <div id="sets-${Date.now()}"></div>
                <button onclick="addSetInput(this)" class="secondary">+ Adicionar S√©rie</button>
                <textarea placeholder="Observa√ß√µes sobre este exerc√≠cio (opcional)" class="exercise-note" rows="2"></textarea>
                <button onclick="this.parentElement.remove()" class="delete-btn" style="margin-top: 10px;">Remover Exerc√≠cio</button>
            `;
            container.appendChild(exerciseDiv);
            addSetInput(exerciseDiv.querySelector('button'));
        }

        function addSetInput(button) {
            const setsContainer = button.previousElementSibling;
            const setDiv = document.createElement('div');
            setDiv.className = 'form-row';
            setDiv.innerHTML = `
                <input type="number" placeholder="Repeti√ß√µes" min="1" />
                <input type="number" placeholder="Peso (kg)" step="0.5" min="0" />
                <button onclick="this.parentElement.remove()" class="delete-btn">Remover</button>
            `;
            setsContainer.appendChild(setDiv);
        }

        // Save Workout
        function saveWorkout() {
            const date = document.getElementById('workoutDate').value;
            if (!date) {
                alert('Por favor, selecione uma data');
                return;
            }

            const exercises = [];
            document.querySelectorAll('#exerciseInputs .workout-entry').forEach(entry => {
                const name = entry.querySelector('.exercise-name-input').value;
                const note = entry.querySelector('.exercise-note').value;
                if (!name) return;

                const sets = [];
                entry.querySelectorAll('.form-row').forEach(setRow => {
                    const inputs = setRow.querySelectorAll('input');
                    const reps = parseInt(inputs[0].value);
                    const weight = parseFloat(inputs[1].value);
                    if (reps && weight >= 0) {
                        sets.push({ reps, weight });
                    }
                });

                if (sets.length > 0) {
                    exercises.push({ name, sets, note: note || null });
                }
            });

            if (exercises.length === 0) {
                alert('Adicione pelo menos um exerc√≠cio com s√©ries');
                return;
            }

            workouts.push({
                id: Date.now(),
                date,
                exercises,
                timestamp: new Date().toISOString()
            });

            localStorage.setItem('workouts', JSON.stringify(workouts));
            
            // Clear inputs
            document.getElementById('exerciseInputs').innerHTML = '';
            addExerciseInput();
            document.getElementById('workoutDate').valueAsDate = new Date();

            loadWorkoutHistory();
            updateStats();
            alert('‚úÖ Treino salvo com sucesso!');

            // Auto-backup to Google Drive if connected
            if (googleDriveToken) {
                backupToGoogleDrive(true);
            }
        }

        // Load Workout History
        function loadWorkoutHistory() {
            const container = document.getElementById('workoutHistory');
            if (workouts.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">Nenhum treino registrado ainda</p>';
                return;
            }

            container.innerHTML = workouts
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(workout => `
                    <div class="workout-entry">
                        <div class="workout-header">
                            <strong>${new Date(workout.date).toLocaleDateString('pt-BR')}</strong>
                            <button class="delete-btn" onclick="deleteWorkout(${workout.id})">üóëÔ∏è Excluir</button>
                        </div>
                        <div class="exercise-list">
                            ${workout.exercises.map(ex => `
                                <div class="exercise-item">
                                    <div class="exercise-name">${ex.name}</div>
                                    ${ex.sets.map((set, i) => `
                                        <span class="set-info">S√©rie ${i + 1}: ${set.reps} reps √ó ${set.weight}kg</span>
                                    `).join('')}
                                    ${ex.note ? `
                                        <div class="note-section">
                                            <div class="note-text">üìù ${ex.note}</div>
                                        </div>
                                    ` : ''}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `).join('');
        }

        // Delete Workout
        function deleteWorkout(id) {
            if (confirm('Tem certeza que deseja excluir este treino?')) {
                workouts = workouts.filter(w => w.id !== id);
                localStorage.setItem('workouts', JSON.stringify(workouts));
                loadWorkoutHistory();
                updateStats();
                if (googleDriveToken) {
                    backupToGoogleDrive(true);
                }
            }
        }

        // Update Statistics
        function updateStats() {
            const container = document.getElementById('statsContainer');
            const totalWorkouts = workouts.length;
            const totalExercises = workouts.reduce((sum, w) => sum + w.exercises.length, 0);
            const totalSets = workouts.reduce((sum, w) => 
                sum + w.exercises.reduce((exSum, ex) => exSum + ex.sets.length, 0), 0
            );
            const totalVolume = workouts.reduce((sum, w) => 
                sum + w.exercises.reduce((exSum, ex) => 
                    exSum + ex.sets.reduce((setSum, set) => setSum + (set.reps * set.weight), 0), 0), 0
            );

            container.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${totalWorkouts}</div>
                    <div class="stat-label">Total de Treinos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalExercises}</div>
                    <div class="stat-label">Exerc√≠cios Realizados</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalSets}</div>
                    <div class="stat-label">S√©ries Completadas</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${totalVolume.toFixed(0)}</div>
                    <div class="stat-label">Volume Total (kg)</div>
                </div>
            `;
        }

        // Status Messages
        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            setTimeout(() => element.innerHTML = '', 5000);
        }

        // Export Functions
        function exportToJSON() {
            const dataStr = JSON.stringify(workouts, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `gym-workouts-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function exportToCSV() {
            let csv = 'Data,Exerc√≠cio,S√©rie,Repeti√ß√µes,Peso (kg),Observa√ß√£o\n';
            workouts.forEach(workout => {
                workout.exercises.forEach(exercise => {
                    exercise.sets.forEach((set, index) => {
                        csv += `${workout.date},${exercise.name},${index + 1},${set.reps},${set.weight},"${exercise.note || ''}"\n`;
                    });
                });
            });

            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `gym-workouts-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // Import Function
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (!file) {
                alert('Selecione um arquivo para importar');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        if (confirm(`Importar ${imported.length} treinos? Isso ir√° ADICIONAR aos dados existentes.`)) {
                            workouts = [...workouts, ...imported];
                            localStorage.setItem('workouts', JSON.stringify(workouts));
                            loadWorkoutHistory();
                            updateStats();
                            alert('‚úÖ Dados importados com sucesso!');
                        }
                    }
                } catch (error) {
                    alert('‚ùå Erro ao importar arquivo. Verifique o formato.');
                }
            };
            reader.readAsText(file);
        }

        // Clear All Data
        function clearAllData() {
            if (confirm('‚ö†Ô∏è ATEN√á√ÉO: Isso ir√° apagar TODOS os seus dados permanentemente. Tem certeza?')) {
                if (confirm('√öltima confirma√ß√£o: Todos os treinos ser√£o perdidos. Continuar?')) {
                    workouts = [];
                    localStorage.clear();
                    loadWorkoutHistory();
                    updateStats();
                    alert('Todos os dados foram removidos.');
                }
            }
        }

        // Google Drive Functions
        const GOOGLE_CLIENT_ID = 'YOUR_CLIENT_ID_HERE'; // Substitua pelo seu Client ID
        const GOOGLE_API_KEY = 'YOUR_API_KEY_HERE'; // Substitua pela sua API Key
        const DISCOVERY_DOC = 'https://www.googleapis.com/discovery/v1/apis/drive/v3/rest';
        const SCOPES = 'https://www.googleapis.com/auth/drive.file';

        function authenticateGoogleDrive() {
            gapi.load('client:auth2', async () => {
                await gapi.client.init({
                    apiKey: GOOGLE_API_KEY,
                    clientId: GOOGLE_CLIENT_ID,
                    discoveryDocs: [DISCOVERY_DOC],
                    scope: SCOPES
                });

                const authInstance = gapi.auth2.getAuthInstance();
                if (!authInstance.isSignedIn.get()) {
                    await authInstance.signIn();
                }

                const token = gapi.auth.getToken().access_token;
                localStorage.setItem('googleDriveToken', token);
                googleDriveToken = token;
                showStatus('backupStatus', '‚úÖ Conectado ao Google Drive com sucesso!', 'success');
            });
        }

        async function backupToGoogleDrive(silent = false) {
            if (!googleDriveToken) {
                if (!silent) alert('Primeiro conecte ao Google Drive');
                return;
            }

            const data = JSON.stringify(workouts, null, 2);
            const metadata = {
                name: 'gym-training-backup.json',
                mimeType: 'application/json'
            };

            const form = new FormData();
            form.append('metadata', new Blob([JSON.stringify(metadata)], { type: 'application/json' }));
            form.append('file', new Blob([data], { type: 'application/json' }));

            try {
                const response = await fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
                    method: 'POST',
                    headers: { 'Authorization': `Bearer ${googleDriveToken}` },
                    body: form
                });

                if (response.ok) {
                    if (!silent) showStatus('backupStatus', '‚úÖ Backup realizado com sucesso!', 'success');
                } else {
                    throw new Error('Backup failed');
                }
            } catch (error) {
                if (!silent) showStatus('backupStatus', '‚ùå Erro ao fazer backup', 'error');
            }
        }

        async function restoreFromGoogleDrive() {
            if (!googleDriveToken) {
                alert('Primeiro conecte ao Google Drive');
                return;
            }

            // Implementation for restore would go here
            alert('Fun√ß√£o de restaura√ß√£o em desenvolvimento');
        }

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('Service Worker registered'))
                .catch(err => console.log('Service Worker registration failed'));
        }
    </script>
    <script src="https://apis.google.com/js/api.js"></script>
</body>
</html>
